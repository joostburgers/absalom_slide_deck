---
title: 'Digital Supplement: *Absalom, Absalom!* and the Digital Humanities'
author: "Johannes Burgers"
date: "This interactive essay acts as a supplement to the long-form essay available in the *Norton Critical Edition* of *Absalom, Absalom!*. It includes visualizations that are not possible to represent in print, and also functions as a standalone essay that explores *Absalom, Absalom!* along three different axes: Characters, Events, and Language."
output: 
  revealjs::revealjs_presentation:
    theme: solarized
    self_contained: false
    reveal_plugins: ["menu"]
    reveal_options:
      menu:
        side: right
---

```{r setup, include=FALSE, message = FALSE, warning=FALSE, error=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning=FALSE, error=FALSE, tidy='styler')
knitr::knit_engines$set(python = reticulate::eng_python)
```

```{r load_packages}
#Data wrangling
library(tidyverse)
library(tidytext)
library(stringr)
library(lubridate)

#Python interoperability
library(reticulate)

#Visualization
library(plotly)

#Output
library(shiny)
library(scales)
library(webshot)
```

```{r load_text}
#Read in the text
absalom_txt <- data_frame(text = read_file("data/absalom_parse_copy_10_16.txt"))

absalom_df <- absalom_txt %>% 
mutate(text = gsub("[‘’]", "'", text)) %>% 
              unnest_tokens(text, text) %>% 
              summarize(text = str_c(text, collapse = " "))
```

```{r _load_event_sentences}
absalom_event_sentences <- read_csv("data/absalom_event_sentences_clean_2021_5_10.csv")

#This file was created by recomposing the text based on the "First Words" column and matching the text segments with each event using a copy of the text. As this process is quite involved it has been branched out into a separate file: absalom_sentiment_text_processing. Full details on the process can be viewed there.

```

```{r global_variables}
absalom_length <- str_count(absalom_df$text, "\\S+")
```

```{r absalom_event_word_count}
event_length <- absalom_event_sentences %>%
  mutate(event_words = str_count(event_sentence,  "\\S+")) %>%
  select(EventID, begin_word, end_word, event_sentence, event_words)
```

```{r read_all_absalom_events}
absalom_all_events <- read_csv("data/absalom_all_events_2021_5_11.csv")
```

```{r event_dates}
aa_event_dates <- read_csv("data/absalom_event_dates_05_15.csv")

aa_event_dates <- aa_event_dates %>% 
                  mutate(StartDate=str_trim(StartDate)) %>% 
                  mutate(EndDate= str_trim(EndDate)) %>% 
                  select(EventID, StartDate, EndDate) %>% 
                  drop_na()
```

```{r chapter_numbers}
chapter_numbers <- read_csv("data/chapter_numbers.csv")
```

```{r clean_up_absalom_events}
#The full table is long and hard to work with.
absalom_events_short <- absalom_all_events %>%
  select(3:8, 11, 13, 21:28, 34, 50, 52:54) %>%
  mutate(narrator = str_extract(Summary, "(?<=(SOURCE)).+[^]</p>]")) %>%
  mutate(narrator = str_replace_all(narrator, ":", "")) %>%
  left_join(event_length, by = "EventID") %>%
  left_join(chapter_numbers, by = "PageNumber") %>%
  left_join(aa_event_dates, by = "EventID") %>%
  relocate(StartDate, .after = NarrativeStatus) %>%
  relocate(EndDate, .after = StartDate)
```

```{r fetch_compact_db}
dy_events_short <- read_csv("data/compact_database_10_16.csv")
```

```{r read_all_DY_events, eval=FALSE}
#dy_events <- read_csv("data/full_database_2021_5_11.csv")
```

```{r clean_up_all_events, eval=FALSE}
#dy_events_short <- dy_events %>%
 # select(1:11, 21:27, 50, 52:54)
```

```{r, eval=FALSE}
#write_csv(dy_events_short, "data/compact_database_10_16.csv")
```

```{r load_chart_styling, echo=FALSE}
#Page styling

#This is where you create your own custom color palette for the traces.
faulkner_colorway = c("#132C53","#F27A18","#ae0700","#79b473","#38726c","#76bed0","#6b2d5c","#448b2d","#e6d812")

faulkner_colorway_highlight_1 = c(
  "rgba(19, 44, 83, 1)",
  "rgba(242, 122, 24,.1)",
  "rgba(174, 7, 0,.05)",
  "rgba(121, 180, 115,.1)",
  "rgba(56, 114, 108,.1)",
  "rgba(118, 190, 208,.1)"
)

faulkner_colorway_highlight_2 = c(
  "rgba(19, 44, 83, .1)",
  "rgba(242, 122, 24,1)",
  "rgba(174, 7, 0,.05)",
  "rgba(121, 180, 115,.1)",
  "rgba(56, 114, 108,.1)",
  "rgba(118, 190, 208,.1)"
)

faulkner_colorway_highlight_3 = c(
  "rgba(19, 44, 83, .1)",
  "rgba(242, 122, 24,.1)",
  "rgba(174, 7, 0,1)",
  "rgba(121, 180, 115,.1)",
  "rgba(56, 114, 108,.1)",
  "rgba(118, 190, 208,.1)")

faulkner_colorway_bw = c("#999999", "#777777",	"#555555", "#333333",	
"#111111")

#This controls the background color for the entire chart. Probably best left white.
faulkner_paperbackground = c('rgba(255,255,255,0)')

#This controls the background for the plot. Probably best left white.
faulkner_plotcolor = c('rgba(255,255,255,.3)')

#Margin 

m <- list(l = 50, r = 50, b = 50, t = 50, pad = 4)

#Caption Style

fig_caption <- "font-family: 'Open Sans','Helvetica Neue',Helvetica,Arial,sans-serif; font-weight: normal; font-size:90%"

plot_font <- list(family = "'Playfair Display','Helvetica Neue',Helvetica,Arial,sans-serif",
  size = 12,
  color = '#363636')
```

```{r general_overview}
#Unique Characters
unique_characters <- absalom_events_short %>%
  distinct(CharacterName) %>% 
  nrow()
  
#Characters based on rank
peripheral_characters <- absalom_events_short %>%
  filter(PresentMentioned == "Present") %>%
  distinct(CharacterName, .keep_all = TRUE) %>%
  count(Rank) %>%
  mutate(percent = n / sum(n))

#Events in which Judith Sutpen is present
Judith_events <- absalom_events_short %>%
  filter(PresentMentioned == "Present") %>%
  filter(CharacterName == "Judith Sutpen")

#All characters surrounding Judith
Judith_unique_all <- absalom_events_short %>%
  semi_join(Judith_events, by = "EventID") %>%
  filter(PresentMentioned == "Present") %>%
  distinct(CharacterName, .keep_all = TRUE) %>%
  filter(CharacterName != "Judith Sutpen")

#All minor and peripheral characters surrounding Judith
Judith_unique <- Judith_unique_all %>%
  filter(Rank %in% c("Peripheral", "Minor")) %>%
  distinct(CharacterName)

#Events in which Clytie Sutpen is present
Clytie_events <- absalom_events_short %>%
  filter(PresentMentioned == "Present") %>%
  filter(CharacterName == "Clytemnestra")

#All characters surrounding Clytie
Clytie_unique_all <- absalom_events_short %>%
  semi_join(Clytie_events, by = "EventID") %>%
  filter(PresentMentioned == "Present") %>%
  distinct(CharacterName, .keep_all = TRUE) %>%
  filter(CharacterName != "Clytemnestra") %>% 
  nrow()


#Ratio major minor characters DY
character_ranks <- dy_events_short %>%
  filter(PresentMentioned == "Present") %>%
  distinct(CharacterName, .keep_all = TRUE) %>%
  count(Rank) %>%
  mutate(percent = n / sum(n)) %>% 
  arrange(Rank)

#Events in which Henry Sutpen is present
Henry_events <- absalom_events_short %>%
  filter(PresentMentioned == "Present") %>%
  filter(CharacterName == "Henry Sutpen")

#All characters surrounding Henry
Henry_unique_all <- absalom_events_short %>%
  semi_join(Henry_events, by = "EventID") %>%
  filter(PresentMentioned == "Present") %>%
  distinct(CharacterName, .keep_all = TRUE) %>%
  filter(CharacterName != "Henry Sutpen") %>% 
  nrow()

#Events in which Thomas Sutpen is present
Thomas_events <- absalom_events_short %>%
  filter(PresentMentioned == "Present") %>%
  filter(CharacterName == "Thomas Sutpen")

#All characters surrounding Thomas
Thomas_unique_all <- absalom_events_short %>%
  semi_join(Thomas_events, by = "EventID") %>%
  filter(PresentMentioned == "Present") %>%
  distinct(CharacterName, .keep_all = TRUE) %>%
  filter(CharacterName != "Thomas Sutpen") %>% 
  nrow()
```

```{r black_white_ratios}
all_characters <- dy_events_short %>%
  distinct(CharacterName) %>%
  nrow()

black_white_all <- dy_events_short %>%
  # filter(SourceTextCode!="AA") %>%
  distinct(CharacterName, .keep_all = TRUE) %>%
  count(Race) %>%
  mutate(percent = n / sum(n))
```

```{r count_char}
char_count_AA <- absalom_events_short %>%
  filter(PresentMentioned == "Present") %>% 
  distinct(CharacterName, Race) %>%
  count(Race)  %>%
  mutate(percent = round(n / sum(n),2)) %>% 
 mutate(Race = ifelse(Race=="MixedBlackWhite", "Mixed Ancestry", Race))
```

```{r weight_count}
weight_count <- absalom_events_short %>%
  filter(PresentMentioned == "Present") %>%

  group_by(Race) %>%
  summarize(word_total = sum(event_words)) %>%
  mutate(percent = round(word_total / sum(word_total),2)) %>% 
  mutate(Race = ifelse(Race=="MixedBlackWhite", "Mixed Ancestry", Race))  
  #filter(percent >0)

word_total <- weight_count %>% 
              summarise(sum(word_total))

```

```{r weight_count_event}
weight_count_event <- absalom_events_short %>%
  filter(PresentMentioned == "Present") %>%
  select(EventID, Race) %>% 
  distinct() %>% 
  count(Race)
```

# Introductions

*Absalom, Absalom!* is a notoriously difficult text.

Told from multiple, fragmentary, and contradictory perspectives through a highly convoluted stream-of-consciousness narration, the text resists any reading that establishes an ultimate meaning.

# and Complications

In that spirit, this supplement does not provide an over-arching explanation of the text, but uses different visualizations to understand different aspects of the text:

::: incremental
-   Characters
-   Locations
-   Events
-   Language
:::

# Navigation

While each module is interconnected, they can also be read in isolation. Each module has its own heading, and navigating down unlocks more and more detail about each particular topic.

# Characters {data-background-image="assets/images/manuscript_sutpens.jpg"}

>“money, a house, a plantation, slaves, a family — incidentally of course, a wife”

## Literary Demography

The *Digital Yoknapatawpha* [*Digital Yoknapatawpha*](http://faulkner.iath.virginia.edu/) database contains every character who appears in Faulkner's Yoknapatawpha fictions. 

. . .

Each character has a set of attribute information, including their race, class, gender, number, rank, and vitality.

. . .

With this information, we can model the composition of the entire character population.
. . .

> This model is a literary demography

. . .

One of the most salient pieces of demographic information in *Absalom, Absalom!* is **race**.







## Race {data-background-image="assets/images/movie_theater_stairs.jpg"}

. . .

> As a reader you have been forced to hunt for a drop of black blood that means everything and nothing. The insanity of racism. - Toni Morrison, *Conversations*

. . .

Racial segregation was a central feature of the American South before the Civil Rights Movement.

. . .

Faulkner was highly sensitive to how this artificial 'color line' structured social relations.

## Measuring Race

There are `r unique_characters` unique characters in *Absalom, Absalom!*.

. . . 

The overwhelming majority of these characters are [White]{style="color:#132C53; background: rgba(240,241,235,0)"}.

. . .

```{r}
plot_demography <- plot_ly()

plot_demography <- plot_demography %>% 
      add_pie(
      values =  ~char_count_AA$n,
    labels = ~ char_count_AA$Race,
    type = 'pie',
    name = "Character Count",
    text = paste(char_count_AA$Race, char_count_AA$percent*100, "%"),
    textinfo = 'text',
    hovertemplate = paste("Total", char_count_AA$Race,"characters:", char_count_AA$n,
    '<extra></extra>')
    )
plot_demography <- plot_demography %>% layout(
    title = "Character Demography",
    showlegend = FALSE,
    colorway = faulkner_colorway,
    font = plot_font,
    margin = m,
    autosize = FALSE,
    width = 1024,
    paper_bgcolor = faulkner_paperbackground,
    plot_bgcolor = faulkner_plotcolor,
     modebar = list(bgcolor= faulkner_paperbackground)
     )
plot_demography
```

## Narrative Presence

Simply counting the total number of characters in a text does not account for the number of times they occur in the text.

. . .

Statistically speaking, there is only one Moor in Shakespeare's *Othello*, but as he appears in nearly every scene he is one of the most present characters.

. . .

We can weight for character presence by calculating how often they occur in an event.

## Character Count vs. Character Presence

Weighting by narrative presence actually underscores the presence of [White]{style="color:#132C53; background: rgba(240,241,235,0)"} characters more.

```{r plot_demography}

#, fig.cap="Figure 1: Demography by raw count and by character presence. The image on the left shows what percentage of each type of character are present in the text. The image on the right shows how often they appear."

plot_demography <- plot_ly()

plot_demography <- plot_demography %>% 
      add_pie(
      values =  ~char_count_AA$n,
    labels = ~ char_count_AA$Race,
    type = 'pie',
    name = "Character Count",
    text = paste(char_count_AA$Race, char_count_AA$percent*100, "%"),
    textinfo = 'text',
       hovertemplate = paste("Total ", char_count_AA$Race," characters: ", char_count_AA$n,
    '<extra></extra>', sep=""),
    domain = list(x=c(.1,.45), y = c(.1,.9))
    
  )

plot_demography <- plot_demography %>% 
  add_pie(
        values = ~ weight_count$word_total,
    labels = ~ weight_count$Race,
    type = 'pie',
    name = "Character Appearance",
    text = paste(weight_count$Race, weight_count$percent*100, "%"),
    textinfo = 'text',
       hovertemplate = paste(weight_count$Race," characters appear in ", weight_count$percent*100, "% of the text", "<extra></extra>", sep=""),
    domain = list(x = c(.55,.9), y = c(.1,.9))
 
  )

plot_demography <- plot_demography %>% layout(
    title = "Character Demography",
    showlegend = FALSE,
    colorway = faulkner_colorway_highlight_1,
    font = plot_font,
    margin = m,
    autosize = FALSE,
    width = 1024,
    paper_bgcolor = faulkner_paperbackground,
    plot_bgcolor = faulkner_plotcolor,
    modebar = list(bgcolor= faulkner_paperbackground)
  )

plot_demography <- plot_demography %>% add_annotations(
  x = c(.2,.8),
  y = c(1, 1),
  xref = 'paper',
  yref = 'paper',
  showarrow = FALSE,
  text = c("Raw Count", "Present in Events"),
  font = list(size = 14),
  align = 'left'
  
)

plot_demography <-  plot_demography %>%
  config(
    toImageButtonOptions = list(
      format = "png",
      width = 1024,
      height = 605
    )
  )

  
plot_demography
```

## Character Count vs. Character Passing

Meanwhile, the number of [Mixed Ancestry]{style="color:#ae0700; background: rgba(240,241,235,0)"} characters increases.

```{r}

plot_demography <- plot_demography %>% layout(
    colorway = faulkner_colorway_highlight_3
  )

plot_demography
```

## Character Count vs. Character Passing

But only because [Black]{style="color:#F27A18; background: rgba(240,241,235,0)"} characters are less present.

```{r}
plot_demography <- plot_demography %>% layout(
        colorway = faulkner_colorway_highlight_2
      )

plot_demography
```

## Whiteness and Racial Passing

The data suggest that while *Absalom, Absalom!* is concerned with the 'color line', it is decidedly from a White perspective.

. . .

Race and racial passing is only conceived in how it might trouble Whiteness and not how it might affect the Black community.

## Passing Characters

<span style="font-size:70%">Charles Bon is more present in the text than all other [Mixed Ancestry]{style="color:#ae0700; background: rgba(240,241,235,0)"} characters combined, but is simply another major character compared to the [White]{style="color:#132C53; background: rgba(240,241,235,0)"} characters.</span>

```{r}
sunburst <- read_csv("data/sunburst_final.csv")
```

```{r}
sunburst <- sunburst %>% 
            mutate(race = str_trim(str_remove_all(parents, "Total -"))) 

sunburst_totals <- sunburst %>% 
                   slice(2:6) %>% 
                    mutate(race = labels) %>% 
                  select(race, values) %>% 
                  rename(value_total = values)

sunburst <- sunburst %>% 
            left_join(sunburst_totals) %>% 
            mutate(value_total = ifelse(str_detect(race, "Total")==TRUE, values[1],value_total)) %>% 
            mutate(percent = round(values/value_total*100,0))
```

```{r sunburst_plot}
demography_sunburst <- plot_ly(
  labels = sunburst$labels,
  parents = sunburst$parents,
    values = sunburst$values,
  ids = sunburst$ids,
  type = 'sunburst',
    hovertemplate = paste(sunburst$percent, "% of ", sunburst$race,
    '<extra></extra>', sep="")
)

demography_sunburst <- demography_sunburst %>% 
 add_annotations(
  x = 0,
  y = 1,
  xref = 'paper',
  yref = 'paper',
  showarrow = FALSE,
  text = c("Click on the Race labels to view individual charts"),
  font = list(size = 10)
)

demography_sunburst <- demography_sunburst %>% 
    layout(
    title = "Character Presence",
    showlegend = FALSE,
    colorway = c("#132C53","#ae0700","#F27A18","#79b473","#38726c","#76bed0","#6b2d5c","#448b2d","#e6d812"),
    #The colorway had to be reversed to account for Plotly taking the higher value to match the colorway.
    font = plot_font,
    margin = m,
    paper_bgcolor = faulkner_paperbackground,
    plot_bgcolor = faulkner_plotcolor,
    modebar = list(bgcolor= faulkner_paperbackground)
  )


div(demography_sunburst,align = "center")
```

## Passed over Characters

Meanwhile, the most present [Black]{style="color:#F27A18; background: rgba(240,241,235,0)"} characters are the unnamed enslaved characters.

```{r black_sunburst}
black_sunburst <- sunburst %>% 
                  filter(parents =="Total - Black" | ids == "Total - Black" | labels == "Total")
```

```{r}
demography_sunburst_black <- plot_ly(
  labels = black_sunburst$labels,
  parents = black_sunburst$parents,
    values = black_sunburst$values,
  ids = black_sunburst$ids,
  type = 'sunburst',
    hovertemplate = paste(black_sunburst$percent, "% of ", black_sunburst$race,
    '<extra></extra>', sep=""),
  level = 'Total - Black'
)



demography_sunburst_black <- demography_sunburst_black %>% 
    layout(
    title = "Character Presence",
    showlegend = FALSE,
    colorway = c("#F27A18","#ae0700"),
    font = plot_font,
    margin = m,
    paper_bgcolor = faulkner_paperbackground,
    plot_bgcolor = faulkner_plotcolor,
    modebar = list(bgcolor= faulkner_paperbackground)
  )


demography_sunburst_black
```

## Passing Thoughts

<span style = "font-size: 80%"> It is clear from reading *Absalom, Absalom!* that the novel is about Charles Bon's potential transgression across the 'color line.' The data reveal that the novel attends to this issue from a predominantly White perspective, and at the exclusion of all other non-white characters.</span>

<span style = "font-size: 80%">The various narrators only really care about racial passing if it threatens upper class white femininity.</span> 

<span style = "font-size: 80%">As such, they naturalize racial difference, and also circumscribe the boundaries of gender, sexuality, and class. </span>

<span style = "font-size: 80%">In the highly fraught social circumstances of the pre-Civil Rights South, there is no way to separate race, class, gender, and sexuality.</span>

# Events {data-background-image="assets/images/manuscript_chronology.jpg"}

>“Maybe happen is never once”

## Events Overview

*Absalom, Absalom!* resists summary. It is told from multiple, contradictory perspectives that each re-tell the same set of historical events: Thomas Sutpen arrives in Jefferson and starts a family with Ellen Coldfield. He has a son, Henry, and a daughter, Judith. Judith falls in love with Henry's friend from college Charles Bon. On the day Judith and Charles are supposed to marry, Henry kills him and disappears. 

. . . 

No one knows why,

. . . 

but everyone has a theory.

## Blackbirds

Faulkner was once asked if any one of the characters has the "right view."

. . .

> In Absalom, Absalom! is any one of the people who talk about Sutpen have the right view, or is it more or less a case of thirteen ways of looking at a blackbird with none of them [getting it?] right? - May 8th, 1958 [Faulkner at Virginia](https://faulkner.lib.virginia.edu/display/wfaudio29_1.html#wfaudio29_1.11)

. . . 

His answer is telling...

##  {data-background-video="assets/video/faulkner_blackbird.mp4"}

## Plotting the Story

Though the plot can be very confusing, it is clear from Faulkner's notes that he had an underlying structure.

This underlying structure is sometimes referred to as the **chronology** or **story**.

## Story vs. Plot

Often used interchangeable, **story** and **plot** describe two different aspects of a narrative.

. . . 

**Plot** - The order of events in which they are told to the reader.

. . . 

**Story** - The order of events as they actually occur. This is also known as **chronology**.

## Sutpen's Story and Plot

Faulkner does not tell us the events in the order they occur (**story**). Instead, he reorganizes them into a non-linear order (**plot**).

We can see this distinction with his delayed revelations about Sutpen's life.

## Sutpen's Plot and Story

Following the order of events as Quentin discovers them, we learn several important details about him out of order:

::: incremental
- **Chapter 1**: Sutpen arrives in Jefferson
- **Chapter 6**: Sutpen is killed by Jones
- **Chapter 7**: Sutpen is born in Virginia
:::

. . .

These should be re-sorted to tell the **story**.

::: incremental
- **Chapter 7**: Sutpen is born in Virginia
- **Chapter 1**: Sutpen arrives in Jefferson
- **Chapter 6**: Sutpen is killed by Jones
:::

## Ordering Events

*Digital Yoknapatawpha* has broken down the novel into `r nrow(event_length)` individual events.

An event is any time there is one or more characters at one location for a discrete period of time.

Each of the `r nrow(event_length)` events in the novel was also assigned a number that indicates its order in the **plot** and in the **story/chronology**. 

## Plotting Events

We can take the **plot** and **chronology** data and put them on a chart to show the structure of the narrative.

Chronology is placed on the y-axis, and plot is placed on the x-axis.

Events that are chronologically earlier are lower down, while later events are higher up.

## Sutpen's plot

The **plot** chart shows the events as they are narrated to us, the **story** chart shows the order in which those events happen according to the chronology.

```{r sutpen_plot_outline}
sutpen_outline <-
  tibble(
    Plot = c(1, 6, 7),
    Story = c(6, 7, 1),
    Chrono = c(2, 3, 1),
    name = c(
      "Sutpen arrives in Jefferson",
      "Sutpen killed by Jones",
      "Sutpen born in Virginia"
    ),
    xoffset = c(100, -100, -100),
    yoffset = c(-10, -10, 10)
  )

sutpen_outline <- sutpen_outline %>%
  pivot_longer(1:2, names_to = "series")
```

```{r sutpen_outline_plot, align='center'}
sutpen_outline_plot <- plot_ly(
  sutpen_outline,
  x = ~ value,
  y = ~ Chrono,
  text = ~ name,
  textposition = c(
    'top right',
    'top left',
    'bottom left',
    'bottom left',
    'top left',
    'top right'
  ),
  frame = ~ series,
  type = 'scatter',
  mode = 'markers+text'
)

sutpen_outline_plot <- sutpen_outline_plot %>%
  layout(
    title = list(text = "Plot Structure Chart: Major Events Sutpen"),
    showlegend = FALSE,
    xaxis = list(showgrid = FALSE,
                 title = list(text = "Chapter")),
    yaxis = list(
      title = list(text = "Chronology"),
      showgrid = FALSE,
      tickmode = 'array',
      tickvals = c(1, 2, 3)
    ),
    colorway = faulkner_colorway,
    font = plot_font,
    margin = m,
    autosize = FALSE,
    width = 640,
    paper_bgcolor = faulkner_paperbackground,
    plot_bgcolor = faulkner_plotcolor,
    modebar = list(bgcolor = faulkner_paperbackground)
  )


sutpen_outline_plot <- sutpen_outline_plot %>%
  add_annotations(
    x = 0,
  y = 0,
  xref = 'paper',
  yref = 'paper',
  yshift = -120,
  xshift = 40,
  showarrow = FALSE,
  text = c("Move the slider between Plot and Story to see the different event orders."),
  font = list(size = 10)
    )

sutpen_outline_plot <- sutpen_outline_plot %>%
  config(displayModeBar = FALSE)

sutpen_outline_plot <- sutpen_outline_plot %>%
  animation_opts(2500, easing = "elastic", redraw = FALSE)


div(sutpen_outline_plot, align = "center")
```

## Plotting *Absalom, Absalom!*

<span style= "font-size: 80%">The **plot** structure chart for *Absalom, Absalom!* is incredibly complex, but the **story** mode reveals the basic structure: Four different narrators reconstruct the story of the Sutpen family many years after it has happened.</span>

```{r import_annotations}
#creates a clean csv for export. Not necessary

#chronology_annotations_export <- absalom_chronology %>%
#  select(4, 8:9, 11, 14)

#write_csv(chronology_annotations_export, "annotations_export.csv")

chrono_ann_import <- read_csv("data/annotations_import_revised.csv")

chrono_ann_import <- chrono_ann_import %>%
  drop_na(event) %>%
  select(OrderWithinPage, event)

```

```{r narrative_structure}
#This primes the data for plotly. TODO upstream this in a more logical way. This is just a grab bag of cleaning.

absalom_chronology <- absalom_events_short %>%
  distinct(EventID, .keep_all = TRUE) %>%
  select(1:8, 10, 28:29) %>%
  mutate(Summary = str_remove(Summary, '<p>')) %>%
  mutate(Summary = str_remove(Summary, '</p>')) %>%
  mutate(Summary = gsub("((\\S+\\s){7})", "\\1<br> ", Summary)) %>%
  left_join(chrono_ann_import) %>% 
  mutate(Plot = row_number()) %>% 
  arrange(`Chronological Order`) %>% 
  mutate(Story = row_number()) %>% 
  mutate(Chrono = row_number())  %>%
  mutate(StartDate = as_date(StartDate)) %>%
  arrange(OrderWithinPage) %>%
  mutate(OrderPageEnd = lead(
    OrderWithinPage,
    n = 1,
    default = last(OrderWithinPage)
  )) %>%
  mutate(EventLength = OrderPageEnd - OrderWithinPage) %>%
  relocate(OrderPageEnd:EventLength, .after = OrderWithinPage) %>%
  mutate(NarrativeStatus = str_replace_all(NarrativeStatus, "\\+", ""))

absalom_chronology_bw <-  absalom_chronology %>%
  pivot_wider(names_from = "NarrativeStatus",
              values_from = Chrono)  %>% 
  pivot_longer(14:15, names_to = "Order", values_to = "values")


```
```{r}
#this is for setting text positions
#write_csv(absalom_chronology_bw, "absalom_chronology_plot.csv")
absalom_labels <- read_csv("data/absalom_plot_labels.csv")

```



```{r}
chapters_single <- absalom_chronology_bw %>%
  distinct(chapter, .keep_all = TRUE) %>%                             select(values, chapter)
```




```{r plot_aa_bw}
plot_aa_bw <- plot_ly(
  absalom_labels,
  x = ~ values,
  y = ~ Narrated,
  frame = ~ Order,
  name = 'Narrated',
  text = ~ event,
  textposition = ~ position,
  type = 'scatter',
  mode = 'markers+text',
  marker = list(opacity = .5),
  hovertemplate = paste(
    'Page: %{x}',
    '<br>',
    'Narrative Status: Narrated',
    '<br>',
    'Chronological Order: %{y}',
    '<br>',
    'Start Date:',
    absalom_labels$StartDate,
    '<br>',
    'Summary:',
    '<br>',
    absalom_labels$Summary,
    '<extra></extra>'
  )
)

plot_aa_bw <- plot_aa_bw %>% add_trace(
  x = ~ values,
  y = ~ Told,
  name = 'Told',
  frame = ~ Order,
  type = 'scatter',
  text = ~ event,
  textposition = ~ position,
  mode = 'markers+text',
  hovertemplate = paste(
    'Page: %{x}',
    '<br>',
    'Narrative Status: Told',
    '<br>',
    'Chronological Order: %{y}',
    '<br>',
    'Start Date:',
    absalom_labels$StartDate,
    '<br>',
    'Summary:',
    '<br>',
    absalom_labels$Summary,
    '<extra></extra>'
  )
)

plot_aa_bw <- plot_aa_bw %>% add_trace(
  x = ~ values,
  y = ~ Remembered,
  frame = ~ Order,
  name = paste('Remembered'),
  type = 'scatter',
  text = ~ event,
  textposition = ~ position,
  mode = 'markers+text',
  hovertemplate = paste(
    'Page: %{x}',
    '<br>',
    'Narrative Status: Remembered',
    '<br>',
    'Chronological Order: %{y}',
    '<br>',
    'Start Date:',
    absalom_labels$StartDate,
    '<br>',
    'Summary:',
    '<br>',
    absalom_labels$Summary,
    '<extra></extra>'
  )
  
)
plot_aa_bw <- plot_aa_bw %>% add_trace(
  x = ~ values,
  y = ~ Hypothesized,
  frame = ~ Order,
  name = 'Hypothesized',
  showlegend = TRUE,
  type = 'scatter',
  text = ~ event,
  textposition = ~ position,
  mode = 'markers+text',
  hovertemplate = paste(
    'Page: %{x}',
    '<br>',
    'Narrative Status: Hypothesized',
    '<br>',
    'Chronological Order: %{y}',
    '<br>',
    'Start Date:',
    absalom_labels$StartDate,
    '<br>',
    'Summary:',
    '<br>',
    absalom_labels$Summary,
    '<extra></extra>'
  )
)
plot_aa_bw <- plot_aa_bw %>% add_trace(
  x = ~ values,
  y = ~ NarratedConsciousness,
  frame = ~ Order,
  name = 'Narrated+Consciousness',
  type = 'scatter',
  text = ~ event,
  textposition = ~ position,
  mode = 'markers+text',
  hovertemplate = paste(
    'Page: %{x}',
    '<br>',
    'Narrative Status: Narrated+Consciousness',
    '<br>',
    'Chronological Order: %{y}',
    '<br>',
    'Start Date:',
    absalom_labels$StartDate,
    '<br>',
    'Summary:',
    '<br>',
    absalom_labels$Summary,
    '<extra></extra>'
  )
)

plot_aa_bw <-  plot_aa_bw %>%
  layout(
    title = list(text = "Plot Structure Chart: <i>Absalom, Absalom!</i>"),
    xaxis = list(
      tickmode = 'array',
      tickvals = chapters_single$values,
      ticktext = chapters_single$chapter,
      gridwidth = 1.5,
      title = list(text = "Chapter")
    ),
    yaxis = list(title = list(text = "Chronology"),
                 showgrid = FALSE),
    autosize = FALSE,
    width = 1024,
    height = 480,
    colorway = faulkner_colorway,
    font = plot_font,
    margin = m,
    paper_bgcolor = faulkner_paperbackground,
    plot_bgcolor = faulkner_plotcolor,
    modebar = list(bgcolor = faulkner_paperbackground)
  )
plot_aa_bw <-  plot_aa_bw %>%
 add_annotations(
    x = 0,
  y = 0,
  xref = 'paper',
  yref = 'paper',
  yshift = -120,
  xshift = 40,
  showarrow = FALSE,
  text = c("Move the slider between Plot and Story to see the different event orders."),
  font = list(size = 10)
  )

 

plot_aa_bw <-  plot_aa_bw %>%
  config(displayModeBar = FALSE)


plot_aa_bw <- plot_aa_bw %>%
  animation_opts(3500, easing = "elastic", redraw = FALSE)

div(plot_aa_bw, align = "center")

```
## Pattern Recognition 

<span style = "font-size:80%">Each narrator actually follows a similar pattern. They start the narration in the "deep" past and work their way into the present. They often repeat similar details, but leave out crucial information.</span>

```{r}
absalom_labels_early_chapters <- absalom_events_short %>%
  distinct(EventID, .keep_all = TRUE) %>%
  select(1:8, 10, 28:29) %>%
  filter(chapter<4) %>% 
  mutate(Summary = str_remove(Summary, '<p>')) %>%
  mutate(Summary = str_remove(Summary, '</p>')) %>%
  mutate(Summary = gsub("((\\S+\\s){7})", "\\1<br> ", Summary)) %>%
  left_join(chrono_ann_import) %>% 
  mutate(Plot = row_number()) %>% 
  arrange(`Chronological Order`) %>% 
  mutate(Story = row_number()) %>% 
  mutate(Chrono = row_number())  %>%
  mutate(StartDate = as_date(StartDate)) %>%
  arrange(OrderWithinPage) %>%
  mutate(OrderPageEnd = lead(
    OrderWithinPage,
    n = 1,
    default = last(OrderWithinPage)
  )) %>%
  mutate(EventLength = OrderPageEnd - OrderWithinPage) %>%
  relocate(OrderPageEnd:EventLength, .after = OrderWithinPage) %>%
  mutate(NarrativeStatus = str_replace_all(NarrativeStatus, "\\+", ""))%>%
  pivot_wider(names_from = "NarrativeStatus",
              values_from = Chrono)  %>% 
  pivot_longer(14:15, names_to = "Order", values_to = "values")

absalom_text_positions <- absalom_labels %>% 
                          select(EventID, Order, position)
  
absalom_labels_early_chapters <- absalom_labels_early_chapters %>% 
                                  left_join(absalom_text_positions, by=c("EventID","Order"))
  
  
chapters_single_short <- chapters_single %>% 
                          filter (chapter <4)
```

```{r}
absalom_early_plot <- plot_ly(
  absalom_labels_early_chapters,
  x = ~ values,
  y = ~ Narrated,
  frame = ~ Order,
  name = 'Narrated',
  text = ~ event,
  textposition = ~ position,
  type = 'scatter',
  mode = 'markers+text',
  marker = list(opacity = .5),
  hovertemplate = paste(
    'Page: %{x}',
    '<br>',
    'Narrative Status: Narrated',
    '<br>',
    'Chronological Order: %{y}',
    '<br>',
    'Start Date:',
   absalom_labels_early_chapters$StartDate,
    '<br>',
    'Summary:',
    '<br>',
   absalom_labels_early_chapters$Summary,
    '<extra></extra>'
  )
)

absalom_early_plot <- absalom_early_plot %>% add_trace(
  x = ~ values,
  y = ~ Told,
  name = 'Told',
  frame = ~ Order,
  type = 'scatter',
  text = ~ event,
  textposition = ~ position,
  mode = 'markers+text',
  hovertemplate = paste(
    'Page: %{x}',
    '<br>',
    'Narrative Status: Told',
    '<br>',
    'Chronological Order: %{y}',
    '<br>',
    'Start Date:',
   absalom_labels_early_chapters$StartDate,
    '<br>',
    'Summary:',
    '<br>',
   absalom_labels_early_chapters$Summary,
    '<extra></extra>'
  )
)


absalom_early_plot <- absalom_early_plot %>% add_trace(
  x = ~ values,
  y = ~ Hypothesized,
  frame = ~ Order,
  name = 'Hypothesized',
  showlegend = TRUE,
  type = 'scatter',
  text = ~ event,
  textposition = ~ position,
  mode = 'markers+text',
  hovertemplate = paste(
    'Page: %{x}',
    '<br>',
    'Narrative Status: Hypothesized',
    '<br>',
    'Chronological Order: %{y}',
    '<br>',
    'Start Date:',
   absalom_labels_early_chapters$StartDate,
    '<br>',
    'Summary:',
    '<br>',
   absalom_labels_early_chapters$Summary,
    '<extra></extra>'
  )
)
absalom_early_plot <- absalom_early_plot %>% add_trace(
  x = ~ values,
  y = ~ NarratedConsciousness,
  frame = ~ Order,
  name = 'Narrated+Consciousness',
  type = 'scatter',
  text = ~ event,
  textposition = ~ position,
  mode = 'markers+text',
  hovertemplate = paste(
    'Page: %{x}',
    '<br>',
    'Narrative Status: Narrated+Consciousness',
    '<br>',
    'Chronological Order: %{y}',
    '<br>',
    'Start Date:',
   absalom_labels_early_chapters$StartDate,
    '<br>',
    'Summary:',
    '<br>',
   absalom_labels_early_chapters$Summary,
    '<extra></extra>'
  )
)

absalom_early_plot <-  absalom_early_plot %>%
  layout(
    title = list(text = "Plot Structure Chart: <i>Absalom, Absalom!</i>"),
    xaxis = list(
      tickmode = 'array',
      tickvals = chapters_single_short$values,
      ticktext = chapters_single_short$chapter,
      gridwidth = 1.5,
      title = list(text = "Chapter")
    ),
    yaxis = list(title = list(text = "Chronology"),
                 showgrid = FALSE),
    autosize = FALSE,
    width = 740,
    height = 320,
    colorway = faulkner_colorway,
    font = plot_font,
    margin = m,
    paper_bgcolor = faulkner_paperbackground,
    plot_bgcolor = faulkner_plotcolor,
    modebar = list(bgcolor = faulkner_paperbackground)
  )
absalom_early_plot <-  absalom_early_plot %>%
 add_annotations(
    x = 0,
  y = 0,
  xref = 'paper',
  yref = 'paper',
  yshift = -120,
  xshift = 40,
  showarrow = FALSE,
  text = c("Move the slider between Plot and Story to see the different event orders."),
  font = list(size = 10)
  )

 

absalom_early_plot <-  absalom_early_plot %>%
  config(displayModeBar = FALSE)


absalom_early_plot <- absalom_early_plot %>%
  animation_opts(3500, easing = "elastic", redraw = FALSE)

div(absalom_early_plot, align = "center")
```

## Piecing it together
<div style ="line-height:.7; text-align:left">
<span style = "font-size:50%">We can get better insight into how Faulkner structured *Absalom, Absalom!* by displaying which parts of the story each chapter covers. In **story** mode we see a very mottled line with each chapter seemingly covering all parts of the story. By clicking on each chapter legend entry, we can turn that series on and off, and determine what parts of the story each chapter covers.</span></div>

```{r}
absalom_by_chapter <- absalom_events_short %>%
  distinct(EventID, .keep_all = TRUE) %>%
  select(1:8, 10, 28:29) %>%
  mutate(Summary = str_remove(Summary, '<p>')) %>%
  mutate(Summary = str_remove(Summary, '</p>')) %>%
  mutate(Summary = gsub("((\\S+\\s){7})", "\\1<br> ", Summary)) %>%
  mutate(chapter = paste ("Chapter ", chapter)) %>% 
  left_join(chrono_ann_import) %>% 
  mutate(Plot = row_number()) %>% 
  arrange(`Chronological Order`) %>% 
  mutate(Story = row_number()) %>% 
  mutate(Chrono = row_number())  %>%
  mutate(StartDate = as_date(StartDate)) %>%
  arrange(OrderWithinPage) %>%
  mutate(OrderPageEnd = lead(
    OrderWithinPage,
    n = 1,
    default = last(OrderWithinPage)
  )) %>%
  mutate(EventLength = OrderPageEnd - OrderWithinPage) %>%
  relocate(OrderPageEnd:EventLength, .after = OrderWithinPage) %>%
  mutate(NarrativeStatus = str_replace_all(NarrativeStatus, "\\+", "")) %>% 
  pivot_longer(15:16, names_to = "Order", values_to = "values") %>% 
                                  left_join(absalom_text_positions, by=c("EventID","Order"))


```



```{r}
plot_chapters <- plot_ly(
  absalom_by_chapter,
  x = ~ values,
  y = ~ Chrono,
  frame = ~ Order,
  name = ~chapter,
  text = ~ event,
  textposition = ~ position,
  type = 'scatter',
  mode = 'markers+text',
  marker = list(opacity = .5),
  hovertemplate = paste(
    'Page: %{x}',
    '<br>',
    'Chronological Order: %{y}',
    '<br>',
    'Start Date:',
    absalom_by_chapter$StartDate,
    '<br>',
    'Summary:',
    '<br>',
    absalom_by_chapter$Summary,
    '<extra></extra>'
  )
)



plot_chapters <-  plot_chapters %>%
  layout(
    title = list(text = "Plot Structure Chart: <i>Absalom, Absalom!</i>"),
    xaxis = list(
      tickmode = 'array',
      tickvals = chapters_single$values,
      ticktext = chapters_single$chapter,
      gridwidth = 1.5,
      title = list(text = "Chapter")
    ),
    yaxis = list(title = list(text = "Chronology"),
                 showgrid = FALSE),
    autosize = FALSE,
    width = 1024,
    height = 480,
    colorway = faulkner_colorway,
    font = plot_font,
    margin = m,
    paper_bgcolor = faulkner_paperbackground,
    plot_bgcolor = faulkner_plotcolor,
    modebar = list(bgcolor = faulkner_paperbackground)
  )
plot_chapters <-  plot_chapters %>%
 add_annotations(
    x = 1,
  y = 1,
  xref = 'paper',
  yref = 'paper',
  yshift = -180,
  xshift = 90,
  showarrow = FALSE,
  text = c("Click the legend<br>labels to turn the<br>series on and off"),
  font = list(size = 10),
  align='left'
  )

 

plot_chapters <-  plot_chapters %>%
  config(displayModeBar = FALSE)


plot_chapters <- plot_chapters %>%
  animation_opts(3500, easing = "elastic", redraw = FALSE)

div(plot_chapters, align = "center")

```



```{r}
# This was a trial for looking at the structure through the source, but given that the narrative data is too rich, this does not lead to a very good graph.

# absalom_by_narrator <- absalom_events_short %>%
#   distinct(EventID, .keep_all = TRUE) %>%
#   select(1:8, 10, 28:29) %>%
#   mutate(Summary = str_remove(Summary, '<p>')) %>%
#   mutate(Summary = str_remove(Summary, '</p>')) %>%
#   mutate(Summary = gsub("((\\S+\\s){7})", "\\1<br> ", Summary)) %>% 
#   mutate (Source = str_trim(str_extract(Summary,"(?<=SOURCE:).*[:alpha:]"))) %>% 
#   mutate (Source = str_remove_all(Source,":")) %>% 
#   mutate(chapter = paste ("Chapter ", chapter)) %>% 
#   left_join(chrono_ann_import) %>% 
#   mutate(Plot = row_number()) %>% 
#   arrange(`Chronological Order`) %>% 
#   mutate(Story = row_number()) %>% 
#   mutate(Chrono = row_number())  %>%
#   mutate(StartDate = as_date(StartDate)) %>%
#   arrange(OrderWithinPage) %>%
#   mutate(OrderPageEnd = lead(
#     OrderWithinPage,
#     n = 1,
#     default = last(OrderWithinPage)
#   )) %>%
#   mutate(EventLength = OrderPageEnd - OrderWithinPage) %>%
#   relocate(OrderPageEnd:EventLength, .after = OrderWithinPage) %>%
#   mutate(NarrativeStatus = str_replace_all(NarrativeStatus, "\\+", "")) %>% 
#   pivot_longer(16:17, names_to = "Order", values_to = "values") %>% 
#                                   left_join(absalom_text_positions, by=c("EventID","Order"))


```



```{r}
# narrator_plot <- plot_ly(
#   absalom_by_narrator,
#   x = ~ values,
#   y = ~ Chrono,
#   frame = ~ Order,
#   name = ~Source,
#   text = ~ event,
#   textposition = ~ position,
#   type = 'scatter',
#   mode = 'markers+text',
#   marker = list(opacity = .5),
#   hovertemplate = paste(
#     'Page: %{x}',
#     '<br>',
#     'Chronological Order: %{y}',
#     '<br>',
#     'Start Date:',
#     absalom_by_chapter$StartDate,
#     '<br>',
#     'Summary:',
#     '<br>',
#     absalom_by_chapter$Summary,
#     '<extra></extra>'
#   )
# )
# 
# 
# 
# narrator_plot <-  narrator_plot %>%
#   layout(
#     title = list(text = "Plot Structure Chart: <i>Absalom, Absalom!</i>"),
#     xaxis = list(
#       tickmode = 'array',
#       tickvals = chapters_single$values,
#       ticktext = chapters_single$chapter,
#       gridwidth = 1.5,
#       title = list(text = "Chapter")
#     ),
#     yaxis = list(title = list(text = "Chronology"),
#                  showgrid = FALSE),
#     autosize = FALSE,
#     width = 1024,
#     height = 480,
#     colorway = faulkner_colorway,
#     font = plot_font,
#     margin = m,
#     paper_bgcolor = faulkner_paperbackground,
#     plot_bgcolor = faulkner_plotcolor,
#     modebar = list(bgcolor = faulkner_paperbackground)
#   )
# narrator_plot <-  narrator_plot %>%
#  add_annotations(
#     x = 1,
#   y = 1,
#   xref = 'paper',
#   yref = 'paper',
#   yshift = -180,
#   xshift = 90,
#   showarrow = FALSE,
#   text = c("Click the legend<br>labels to turn the<br>series on and off"),
#   font = list(size = 10),
#   align='left'
#   )
# 
#  
# 
# narrator_plot <-  narrator_plot %>%
#   config(displayModeBar = FALSE)
# 
# 
# narrator_plot <- narrator_plot %>%
#   animation_opts(3500, easing = "elastic", redraw = FALSE)
# 
# div(narrator_plot, align = "center")

```

## Storytelling and History

The overlapping and disjointed versions of events capture Quentin's lived experience of exploring the past. This is not a neat linear chronology told by one authority in a history book, but the collective story of multiple voices who have shaped and reshaped the events to match their version of the truth. The tellers cannot be separated from their tales. It forces us to wonder if any version of the past can ever be true, or if it is simply another story we tell ourselves.

# Language {data-background-video="assets/video/language_type.mp4" data-background-video-loop="true"}




## Language Overview

The language in *Absalom, Absalom!* is very challenging.

. . . 

Faulkner's language constantly draws attention to itself.

. . .

The text reminds us that *what* is said cannot be separated from how it is *said*.


## The longest sentence

```{r sentence_length}

absalom_clean <- absalom_txt %>% 
mutate(text = gsub("[,\\!\\?\\.](?=[^’‘]*’[\\s—-])"," ",text, perl=TRUE))


#Regex explained:
#[,\\!\\?\\.] find any of !,?.
#(?=[^’‘] not followed by curly quote. The closing curly quote is counterintuitive here, but it helps exclude 's as in Sutpen's. Instead, we want all curly quotes followed with a white space \s: 
#*’[\\s—-]) the en and em dash are there because sometimes these can abutt the closing curly quote.

absalom_sentences <- absalom_clean %>%
  unnest_regex(word, text, "[.?!]") %>%
  mutate (string_length = str_count(word, "\\S+")) 

absalom_sentences_mean <-  absalom_sentences %>%
  summarize(mean_length = mean(absalom_sentences$string_length)) %>% 
  mutate(author = "William Faulkner", date = "1936", title = "Absalom, Absalom!") %>% 
  relocate(mean_length, .after = last_col())
  
absalom_sentences_long <- absalom_sentences %>%
  filter(string_length > 99) %>%
  nrow()
```


Sentences in *Absalom, Absalom!* are very long. 

. . . 

On average sentences are `r round(absalom_sentences_mean$mean_length,0)` words long.

. . . 

The longest sentence is `r max(absalom_sentences$string_length)` words! That's a 3-4 page college paper.

## A View of the Long Sentence

Compared to other American Classics, Faulkner's sentences are much, much longer.

```{r author_sentence_lengths, cache = TRUE}
all_works <-
  list.files(path = "data/other_texts/",pattern = "*.txt", full.names = TRUE) %>%   
  #grab a list of all the files with .txt extension
  map_df(~ data_frame(  #the map function performs the same command on all parts of the data set. In this case the .txt files
    text = read_file(.), #read the files
    date = ifelse(
      str_detect(basename(.), "[:digit:]{4}") == TRUE,
      str_extract(basename(.), "[:digit:]{4}"),
      NA
    ) #see if there is a date in yyyy format, i.e. 1987, and extract the date, if it can't fine date NA
  )) %>% 
  mutate(author = str_extract(text, "(?<=Author:).*")) %>% #extract the text after Author: in the document as author
  mutate(author = str_squish(author)) %>% #remove any whitespace
   #detect whether this is First Name Last Name or Last Name, First Name and switch
  mutate(title = str_extract(text, "(?<=Title:).*")) %>% #grab title
  mutate(title = str_squish(title)) %>%  #trim title
  mutate(text = gsub("[,\\!\\?\\.](?=[^’‘]*’[\\s—-])"," ",text, perl=TRUE)) %>% 
   unnest_regex(word, text, "[.?!]")
```


```{r author_sentence_lengths_mean}
all_works_mean <- all_works %>% 
  mutate (string_length = str_count(word, "\\S+")) %>% 
  group_by(author, date, title) %>% 
  summarize(mean_length = mean(string_length)) %>% 
  bind_rows(absalom_sentences_mean) %>% 
  mutate (mean_length = round(mean_length,0)) %>% 
  arrange(date) %>% 
  mutate(display_name = paste(author, "<br>", "<i>",title,"</i>"," (", date, ")", sep="")) %>% 
  ungroup() %>% 
  mutate(order = row_number())
  


```

```{r sentence_length_plot}

sentence_length_plot <- plot_ly(
  all_works_mean,
  x = ~ order,
  y = ~ mean_length,
  type = "bar",
  marker = list(
    color = c(
      faulkner_colorway[2],
      faulkner_colorway[2],
      faulkner_colorway[2],
      faulkner_colorway[1],
      faulkner_colorway[2]
    )
  )
)

sentence_length_plot <- sentence_length_plot %>%
  layout(
    title = list(text = "Average Sentence Lengths in American Classics"),
    xaxis = list(
      tickmode = 'array',
      tickvals = all_works_mean$order,
      ticktext = all_works_mean$display_name,
      title = list(text = "Work")
    ),
    yaxis = list(
      title = list(text = "Words per Sentence"),
      showgrid = FALSE
    ),
    # autosize = FALSE,
    # width = 1024,
    # height = 480,
    font = plot_font,
    margin = m,
    paper_bgcolor = faulkner_paperbackground,
    plot_bgcolor = faulkner_plotcolor,
    modebar = list(bgcolor = faulkner_paperbackground)
  )





sentence_length_plot
  
  
  





```
## Neologisms {data-background-video="assets/video/neologism.mp4" data-background-video-loop="true"}

```{r}
neologisms <- read_csv("data/neologisms_import.csv")
```


Faulkner also concocts neologisms by combining words or adding a prefix to an existing word.

```{r}
# absalom_txt_markov <- absalom_txt %>%
#    unnest_tokens(text, text, token="sentences") %>% 
#   mutate(section = row_number() %/% 10) %>%
#   filter(section > 0) %>%
#   unnest_tokens(word, text) %>%
#   filter(!word %in% stop_words$word)
```


```{r}
# library(widyr)
# absalom_txt_markov %>% 
#   pairwise_count(word, section, sort = TRUE)
# ```
# ```{r}
# word_cors <- absalom_txt_markov %>% 
#   add_count(word) %>% 
#   filter(n >= 20) %>% 
#   select(-n) %>%
#   pairwise_cor(word, section, sort = TRUE)
```

```{r}
# library(ggraph)
# word_cors %>%
#   filter(correlation > .25) %>%
#   as_tbl_graph() %>%
#   ggraph(layout = "fr") +
#   geom_edge_link(aes(edge_alpha = correlation), show.legend = FALSE) +
#   geom_node_point(color = "lightblue", size = 5) +
#   geom_node_text(aes(label = name), repel = TRUE)
```
## Parenthetical

Perhaps the most unique feature of the text is Faulkner's use of parentheses.

. . .
There are 1278 total or 639 pairs.
. . .
These parentheses occur across the text, and also nest within each other three levels deep:

- () Level 1
- (()) Level 2
- ((())) Level 3
- (((()))) Level 4

```{r parenthetical_import}
parenthetical_all_staggered<- read_csv("data/parenthetical_all_staggered.csv")
parenthetical_longest_break<- read_csv("data/parenthetical_longest_break.csv")
chapter_index <- 
read_csv("data/chapter_index.csv")
```
## Quentin

The nestings offer a network of digressions, modifications, amplifications, and dead ends. They represent the constant search for words to tell the story of the Sutpen family.

Appropriately, Quentin is burried deep within this nesting at level 4.

```{r plot_parentheses, out.width="768px",  out.height="250px"}

plot_parentheses <- plot_ly(
  parenthetical_all_staggered,
  x = ~ start,
  y =  ~ depth,
  name  = ~ depth,
  type = 'scatter',
  mode = 'lines+markers',
  marker = list(size = 4),
  line = list(width = 1, dash = "dot"),
    width = 768,
    height = 250
)

plot_parentheses <- plot_parentheses %>%
  layout(
    title = list(text = "Parentheses Nesting Levels in <i>Absalom, Absalom!</i>"),
    xaxis = list(
      gridwidth = 1,
      zeroline = FALSE,
      showline = FALSE,
      tickmode = 'array',
      tickvals = chapter_index$chapter_marker,
      ticktext = chapter_index$chapter,
      title = list(text = "Chapter")
    ),
    yaxis = list(
      title = list(text = "Nesting Level"),
      showgrid = FALSE,
      zeroline = FALSE,
      showline = FALSE,
      linewidth = 0,
      tickmode = 'array',
      tickvals = c(0, 1, 2, 3, 4),
      ticktext = c("Main Text", "1: ()", "2: (())", "3: ((()))", "4: (((())))")
    ),
    colorway = faulkner_colorway,
    font = plot_font,
    margin = m,
    paper_bgcolor = faulkner_paperbackground,
    plot_bgcolor = faulkner_plotcolor,
    modebar = list(bgcolor = faulkner_paperbackground),
    autosize = FALSE
  )

plot_parentheses <- plot_parentheses %>%
  add_annotations(
    x = parenthetical_longest_break$start,
    y = parenthetical_longest_break$depth,
    text = parenthetical_longest_break$sentence,
    xref = "x",
    yref = "y",
    yshift = 15,
    xanchor = "left",
    showarrow = FALSE,
    font = plot_font
)

plot_parentheses <-  plot_parentheses %>% 
  config(
    toImageButtonOptions = list(
      format = "png",
      width = 768,
      height = 250
    )
  )

plot_parentheses

```

## Faulkner's Language

The complexity of Faulkner's language forces the reader to consider the meaning of every word, in every long sentence, throughout the entire work. One cannot pull at any thread in the novel without loosening others. The past existed as a reality but it can only be represented in and through language.